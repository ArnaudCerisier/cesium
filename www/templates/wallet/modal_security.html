<ion-modal-view class="modal-full-height">

  <ion-header-bar class="bar-positive">

    <button class="button button-clear visible-xs"
            ng-if="!slides.slider.activeIndex"
            ng-click="closeModal()" translate>COMMON.BTN_CANCEL
    </button>
    <button class="button button-icon button-clear icon ion-ios-arrow-back buttons header-item"
            ng-click="slidePrev()"
            ng-if="slides.slider.activeIndex">
    </button>

    <h1 class="title" translate>ACCOUNT.SECURITY.TITLE</h1>

    <button class="button button-clear icon-right visible-xs"
            ng-if="!isLastSlide && slides.slider.activeIndex > 1"
            ng-click="doNext()">
      <span translate>COMMON.BTN_NEXT</span>
      <i class="icon ion-ios-arrow-right"></i>
    </button>
  </ion-header-bar>


    <ion-slides options="slides.options" slider="slides.slider">

      <!-- STEP 1 -->
      <ion-slide-page>
        <ion-content class="has-header padding">
          <div class="list">
            <div class="item card item-icon-right stable-bg padding ink dark"
               ng-click="slideTo(2)">
              <i class="icon ion-ios-arrow-right"></i>
              <span ng-bind-html="'ACCOUNT.SECURITY.SAVE_KEYS' | translate"></span>
            </div>
            <div class="item card item-icon-right stable-bg padding ink dark"
                 ng-click="slideNext()">
              <span ng-bind-html="'ACCOUNT.SECURITY.REVOCATION' | translate"></span>
              <i class="icon ion-ios-arrow-right"></i>
            </div>
          </div>

          <div class="padding hidden-xs text-right">
            <button class="button button-clear button-dark ink" ng-click="closeModal()"
                    type="button" translate>COMMON.BTN_CANCEL
            </button>
          </div>
        </ion-content>
      </ion-slide-page>

      <!-- STEP 2: revocation -->
      <ion-slide-page>
        <ion-content class="has-header padding">
          <h3 translate>ACCOUNT.SECURITY.REVOCATION</h3>
          <div class="list">
            <div class="item card item-icon-right stable-bg padding ink dark"
               ng-click="downloadRevokeFile()">
              <i class="icon ion-android-archive"></i>
              <span ng-bind-html="'ACCOUNT.SECURITY.DOWNLOAD_REVOKE' | translate"></span>
            </div>
            <div class="item card item-icon-right stable-bg padding ink dark"
               ng-click="revokeIdentity()">
              <i class="icon ion-minus-circled assertive"></i>
              <span ng-bind-html="'ACCOUNT.SECURITY.DEFINITELY_REVOKE' | translate"></span>
            </div>
          </div>
          <div class="padding hidden-xs text-right">
            <button class="button button-clear button-dark ink" ng-click="closeModal()" type="button" translate>COMMON.BTN_CANCEL
            </button>
          </div>
        </ion-content>
      </ion-slide-page>

      <!-- STEP 3: choose questions -->
      <ion-slide-page>
        <ion-content class="has-header padding" >
          <h3 translate>ACCOUNT.SECURITY.SAVE_KEYS</h3>
           <label class="item item-input item-select">
            <div class="input-label" translate>
              ACCOUNT.SECURITY.LEVEL
            </div>
            <select ng-model="formData.level">
              <option value="2" ng-bind-html="'ACCOUNT.SECURITY.LOW_LEVEL' | translate"></option>
              <option value="4" translate>ACCOUNT.SECURITY.MEDIUM_LEVEL</option>
              <option value="6" translate>ACCOUNT.SECURITY.STRONG_LEVEL</option>
            </select>
          </label>
          <div class="padding-top" translate="ACCOUNT.SECURITY.HELP_LEVEL "
               translate-values="{nb: {{formData.level}}}">
          </div>
          <form name="questionsForm" novalidate ng-submit="doNext('questionsForm')">
            <div class="list"
                 ng-init="setForm(questionsForm, 'questionsForm')">

              <ion-checkbox ng-repeat="question in formData.questions" ng-model="question.checked"
                            ng-required="isRequired()">
                <span style="white-space: normal;">{{question.value | translate}}</span>
              </ion-checkbox>
              <div class="item item-icon-right no-padding-top">
                <a class="dark"><i class="icon ion-android-add" ng-click="addQuestion()"></i></a>
                <div class="list list-inset">
                  <label class="item item-input">
                    <input type="text" placeholder="{{'ACCOUNT.SECURITY.ADD_QUESTION' | translate}}" ng-model="formData.addQuestion"/>
                  </label>
                </div>
              </div>
            </div>
            <div class="padding hidden-xs text-right">
              <button class="button button-clear button-dark ink" ng-click="closeModal()"
                      type="button" translate>COMMON.BTN_CANCEL
              </button>
              <button class="button button-clear button-dark"
                      ng-click="restore()" type="button" translate>ACCOUNT.SECURITY.BTN_RESET
              </button>
              <button class="button button-calm icon-right ion-chevron-right ink"
                      ng-disabled="questionsForm.$invalid" type="submit" translate>
                COMMON.BTN_NEXT
                <i class="icon ion-arrow-right-a"></i>
              </button>
            </div>
          </form>

        </ion-content>
      </ion-slide-page>

      <!-- STEP 4: answers -->
      <ion-slide-page>
        <ion-content class="has-header padding" >
          <h3 translate>ACCOUNT.SECURITY.SAVE_KEYS</h3>

          <form name="answersForm" novalidate ng-submit="doNext('answersForm')">
            <div class="list" ng-init="setForm(answersForm, 'answersForm')">
              <ng-repeat ng-repeat="question in formData.questions |filter:true:checked">
                <label class="item item-input {{smallscreen ? 'item-stacked-label' : 'item-floating-label'}}"
                       ng-class="{'item-input-error': answersForm.$submitted && answersForm['question{{$index}}'].$invalid}">
                  <span class="input-label" style="{{smallscreen ? 'white-space: normal' : ''}}">{{question.value | translate}}</span>
                  <input type="text" name="question{{$index}}" placeholder="{{smallscreen ? '' : question.value | translate}}" ng-model="question.answer" required />
                </label>
                <div class="form-errors"
                     ng-show="answersForm.$submitted && answersForm['question{{$index}}'].$error"
                     ng-messages="answersForm['question{{$index}}'].$error">
                  <div class="form-error" ng-message="required">
                    <span translate="ERROR.FIELD_REQUIRED"></span>
                  </div>
                </div>
              </ng-repeat>
              <div class="padding hidden-xs text-right">
                <button class="button button-clear button-dark ink" ng-click="closeModal()"
                        type="button" translate>COMMON.BTN_CANCEL
                </button>
                <button class="button button-clear button-dark"
                        ng-click="restore()" type="button" translate>ACCOUNT.SECURITY.BTN_CLEAN
                </button>
                <button class="button button-calm icon-right ion-chevron-right ink"
                        ng-disabled="questionsForm.$invalid" type="submit" translate>
                  COMMON.BTN_NEXT
                  <i class="icon ion-arrow-right-a"></i>
                </button>
              </div>
            </div>

          </form>
        </ion-content>
      </ion-slide-page>

      <!-- STEP 5: confirm identity -->
      <ion-slide-page>
        <ion-content>
          <form name="loginForm" novalidate="" ng-submit="submit()">

            <div class="list" ng-init="setForm(loginForm, 'loginForm')">

              <!-- salt (=username, to enable browser login cache) -->
              <label class="item item-input"
                     ng-class="{ 'item-input-error': loginForm.$submitted && loginForm.username.$invalid}">
                <span class="input-label hidden-xs" translate>LOGIN.SALT</span>
                <input ng-if="!showSalt"
                       name="username" type="{{showSalt ? 'text' : 'password'}}" placeholder="{{'LOGIN.SALT_HELP' | translate}}"
                       ng-model="formData.username"
                       ng-model-options="{ debounce: 650 }"
                       class="highlight-light"
                       required>
                <input ng-if="showSalt"
                       name="username" type="text" placeholder="{{'LOGIN.SALT_HELP' | translate}}"
                       ng-model="formData.username"
                       ng-model-options="{ debounce: 650 }"
                       class="highlight-light"
                       required>
              </label>
              <div class="form-errors"
                   ng-show="loginForm.$submitted && loginForm.username.$error"
                   ng-messages="loginForm.username.$error">
                <div class="form-error" ng-message="required">
                  <span translate="ERROR.FIELD_REQUIRED"></span>
                </div>
              </div>

              <!-- Show salt -->
              <div class="item item-toggle dark">
                <span translate>LOGIN.SHOW_SALT</span>
                <label class="toggle toggle-stable">
                  <input type="checkbox" ng-model="showSalt">
                  <div class="track">
                    <div class="handle"></div>
                  </div>
                </label>
              </div>

              <!-- password-->
              <label class="item item-input"
                     ng-class="{ 'item-input-error': loginForm.$submitted && loginForm.password.$invalid}">
                <span class="input-label hidden-xs" translate>LOGIN.PASSWORD</span>
                <input name="password" type="password" placeholder="{{'LOGIN.PASSWORD_HELP' | translate}}"
                       ng-model="formData.password"
                       ng-model-options="{ debounce: 650 }"
                       select-on-click
                       required>
              </label>
              <div class="form-errors"
                   ng-show="loginForm.$submitted && loginForm.password.$error"
                   ng-messages="loginForm.password.$error">
                <div class="form-error" ng-message="required">
                  <span translate="ERROR.FIELD_REQUIRED"></span>
                </div>
              </div>
            </div>

            <div class="padding hidden-xs text-right">
              <button class="button button-clear button-dark ink" ng-click="closeModal()"
                      type="button" translate>COMMON.BTN_CANCEL
              </button>
              <button class="button button-positive ink" type="submit" translate>
                COMMON.BTN_SEND
                <i class="icon ion-android-send"></i>
              </button>
            </div>
          </form>
        </ion-content>
      </ion-slide-page>

    </ion-slides>
</ion-modal-view>
