<ion-view left-buttons="leftButtons">
  <ion-nav-title>
    <span translate>REGISTRY.VIEW.TITLE</span>
  </ion-nav-title>

  <ion-nav-buttons side="secondary">
      <button class="button button-icon button-clear ion-android-create" ng-click="edit()" ng-if="canEdit">
      </button>
  </ion-nav-buttons>

  <ion-content scroll="true">

      <div class="positive-900-bg hero"
           id="profile-header">
        <div class="content">
          <i class="avatar"
             ng-style="avatarStyle"
             ng-class="{'avatar-wallet': !avatarStyle && walletData && !walletData.isMember, 'avatar-member': !avatarStyle && walletData.isMember}">
            <button class="button button-positive button-avatar button-large button-clear flat icon ion-camera hidden-no-device" ng-click="openPicturePopup()"></button>
            <button class="button button-positive button-avatar button-large button-clear flat icon ion-camera hidden-device"
                    onclick="angular.element(document.querySelector('form #avatarFile'))[0].click();"></button>
          </i>
          <div ng-if="formData != null">
            <h3 class="light" ng-if="!formData.title && walletData && walletData.isMember">{{walletData.uid}}</h3>
            <h3 class="light" ng-if="!formData.title && walletData && !walletData.isMember">{{::walletData.pubkey | formatPubkey}}</h3>
            <h3 class="light">{{formData.title}}</h3>
            <h4 class="light"></h4>
          </div>
          <div ng-if="formData == null">
            <h4 class="light">
              <ion-spinner icon="android"></ion-spinner>
            </h4>
          </div>
        </div>
      </div>

      <form name="profileForm" novalidate="" ng-submit="doSave()">

        <input type="file" id="avatarFile" accept=".png,.jpeg,.jpg" onchange="angular.element(this).scope().fileChanged(event)"
               style="visibility:hidden; position:absolute;"/>

        <div class="row no-padding">
          <div class="col col-20 hidden-xs hidden-sm">&nbsp;
          </div>

          <ion-list class="col list animate-fade-slide-in-right item-text-wrap" ng-init="setProfileForm(profileForm)"
                    can-swipe="isDeviceEnable()">


            <span class="item item-divider">
              {{'PROFILE.GENERAL_DIVIDER' | translate}}
            </span>

            <!-- uid -->
            <ion-item class="item" ng-if="walletData && walletData.uid">
              <span class="input-label">{{'COMMON.UID' | translate}}</span>
              <p class="gray">{{walletData.uid}}</p>
            </ion-item>

            <!-- title -->
            <ion-item class="item-input item-floating-label item-button-right">
              <span class="input-label">{{'PROFILE.TITLE' | translate}}</span>
              <input type="text" name="title" placeholder="{{'PROFILE.TITLE_HELP' | translate}}"
                     ng-model="formData.title"
                     ng-model-options="{ debounce: 350 }"
                     required>
            </ion-item>
            <div class="form-errors"
                 ng-show="formData.$submitted && formData.title.$error"
                 ng-messages="profileForm.title.$error">
              <div class="form-error" ng-message="required">
                <span translate="ERROR.FIELD_REQUIRED"></span>
              </div>
            </div>

            <!-- description -->
            <ion-item class="item-input item-floating-label item-button-right">
              <span class="input-label" style="width: 100%">{{'PROFILE.DESCRIPTION' | translate}}</span>
              <textarea placeholder="{{'PROFILE.DESCRIPTION_HELP' | translate}}"
                        ng-model="formData.description"
                        ng-model-options="{ debounce: 350 }"
                        rows="4" cols="10">
              </textarea>
            </ion-item>

            <span class="item item-divider">
              {{'PROFILE.LOCATION_DIVIDER' | translate}}
            </span>

            <!-- address -->
            <ion-item class="item-input item-floating-label item-button-right">
              <span class="input-label">{{'PROFILE.ADDRESS' | translate}}</span>
              <textarea placeholder="{{'PROFILE.ADDRESS_HELP' | translate}}"
                        ng-model="formData.address"
                        ng-model-options="{ debounce: 350 }"
                        rows="4" cols="10">
              </textarea>
            </ion-item>

            <!-- city -->
            <div class="item item-input item-floating-label">
              <span class="input-label" translate>PROFILE.CITY</span>
              <input type="text" placeholder="{{'PROFILE.CITY_HELP'|translate}}"
                     ng-model="formData.city"
                     ng-model-options="{ debounce: 350 }">
            </div>

            <span class="item item-divider">
              {{'PROFILE.SOCIAL_NETWORKS_DIVIDER' | translate}}
            </span>

            <ion-item class="item-remove-animate item-icon-left "
                 type="no-padding item-text-wrap"
                 ng-if="formData.socials && formData.socials.length>0"
                 ng-repeat="social in formData.socials track by social.url"
                 id="social-{{social.url|formatSlug}}">
                <i class="icon ion-social-{{social.type}}"
                   ng-class="{'ion-bookmark': social.type == 'other', 'ion-link': social.type == 'web', 'ion-email': social.type == 'email'}"></i>
                <p ng-if="social.type && social.type != 'web'">{{social.type}}</p>
                <h2>
                  <a href="{{social.url}}" ng-if="social.type != 'email'" target="_blank">{{social.url}}</a>
                  <a href="mailto:{{social.url}}" ng-if="social.type == 'email'">{{social.url}}</a>
                  <a class="gray hidden-device" ng-click="formData.socials.splice($index, 1); doSave();">
                    &nbsp;<b class="ion ion-trash-a"></b>&nbsp;
                  </a>
                  <a class="gray hidden-device" ng-click="editSocialNetwork($index)">
                    &nbsp;<b class="ion ion-edit"></b>&nbsp;
                  </a>
                </h2>
                <ion-option-button class="button-assertive" ng-click="formData.socials.splice($index, 1); doSave();">
                  {{'COMMON.BTN_DELETE'|translate}}
                </ion-option-button>
                <ion-option-button class="button-info" ng-click="editSocialNetwork($index)">
                  {{'COMMON.BTN_EDIT'|translate}}
                </ion-option-button>
            </ion-item>

            <div class="item item-complex item-input-inset">
              <label class="item-input-wrapper">
                <input type="text" style="width:100%" placeholder="{{'PROFILE.SOCIAL_HELP'|translate}}"
                       id="socialUrl"
                       on-return="addSocialNetwork();"
                       ng-model="socialData.url"/>
              </label>
              <button class="button button-small button-icon" ng-click="addSocialNetwork()">
                {{'COMMON.BTN_ADD'|translate}}
              </button>
            </div>

            <span class="item item-divider">
              {{'PROFILE.TECHNICAL_DIVIDER' | translate}}
            </span>

            <!-- pubkey-->
            <span class="item item-icon-left ink" copy-on-click>
                <i class="icon ion-key"></i>
                <p class="gray">{{walletData.pubkey}}</p>
            </span>
          </div>

          <div class="col col-20 hidden-xs hidden-sm">&nbsp;
          </div>
        </div>

      </form>
  </ion-content>

</ion-view>
